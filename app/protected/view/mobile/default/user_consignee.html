<!DOCTYPE HTML>
<html>
<head>
    <{include file='mobile/default/lib/meta.html'}>
    <title>收件地址 - <{$GLOBALS.cfg.site_name}></title>
    <link rel="stylesheet" type="text/css" href="<{$common.theme}>/css/general.css"/>
    <link rel="stylesheet" type="text/css" href="<{$common.theme}>/iconfont/iconfont.css">
    <link rel="stylesheet" type="text/css" href="<{$common.theme}>/css/user.css"/>
    <script type="text/javascript" src="<{$common.theme}>/js/zepto.min.js"></script>
    <script type="text/javascript" src="<{$common.theme}>/js/verydows.mobile.js"></script>
    <script type="text/javascript" src="<{$common.theme}>/js/consignee.js"></script>
    <script type="text/javascript">
        var areaApi = "<{url c='api/area' a='children'}>";

        $(function () {
            getAreaSelect();
            showBuildings()
        });

        var buildings = new Array(
            ["2","3","4南","4北","5南","5北","6南","6北","8","10南","10北","11南","11北","12南","12北","13","14","15","16",//杭州电子科技大学
                "18","21","22","27","28","29","30","31","32东","32西","研究生公寓","其他"],
            ["L楼","1","12","13","14","16","17","18","19","20","21","S楼A区","S楼B区","S楼C区","S楼D区","其他"],//浙江传媒学院
            ["1东","1西","2东","2西","3南","3北","4东","4西","5南","5北","6东","6西","7南","7北","8东","8西","9南","9北",
                "10南","10北","11南","11北","13","其他"],//中国计量大学
            ["一区1","一区2","一区3南","一区3北","一区4南","一区4北","二区2东","二区2西","二区4南","二区4北","二区5南","二区5北"
                ,"二区6南","二区6北","二区12", "三区1西","三区1东","三区3西","三区3东","三区7","三区8","三区9","三区10","三区11","其他"]//浙江理工大学
        );

        function showBuildings() {
            var school_index =$("select[name=school] option").not(function(){ return !this.selected }).val();
            if (school_index) {
                building_list = buildings[school_index-1];
                var options = "";
                for (var i = 0;i < building_list.length;i++) {
                    options += "<option>" + building_list[i] + "</option>";
                }
                $("select[name=building]").html(options);
            }
        }

        function saveConsignee() {
            var form = $('#consignee-form');
            if (checkCsnForm(form)) {
                $.asynInter("<{url c='api/consignee' a='save'}>", form.serialize(), function (res) {
                    if (res.status == 'success') {
                        window.location.href = "<{url c='mobile/consignee' a='list'}>";
                    } else {
                        $.vdsPrompt({content: res.msg});
                    }
                });
            }
        }
    </script>
</head>
<body>
<div class="wrapper">
    <{if !empty($_GET['id'])}>
    <script type="text/javascript">
        $(function () {
            setArea('province', null, '<{$consignee.province}>');
            setArea('city', {province: '<{$consignee.province}>'}, '<{$consignee.city}>');
            setArea('borough', {
                province: '<{$consignee.province}>',
                city: '<{$consignee.city}>'
            }, '<{$consignee.borough}>');
            setBuilding();
        });

        function setArea(type, dataset, selected) {
            var container = $('#areaslt-' + type);
            $.getJSON("<{url c='api/area' a='children'}>", dataset, function (data) {
                var opts = '';
                for (i in data) {
                    if (selected == i) opts += "<option value='" + i + "' selected='selected'>" + data[i] + "</option>"; else opts += "<option value='" + i + "'>" + data[i] + "</option>";
                }
                container.children().first().siblings().remove();
                container.append(opts);
            });
        }

        function setBuilding() {
            var form = $('#consignee-form');
            form.find('select[name="building"] option').each(function (){
                if($(this).val() == "<{$consignee.building}>"){
                    $(this).attr("selected",true);
                }
            });
        }
    </script>
    <div class="header">
        <div class="op lt"><a href="javascript:history.back(-1);"><i class="f20 iconfont">&#xe602;</i></a></div>
        <h2>编辑收件地址</h2>
    </div>
    <div class="address uform module">
        <form id="consignee-form">
            <input type="hidden" name="id" value="<{$consignee['id']}>"/>
            <dl>
                <dt>选择学校</dt>
                <dd>
                    <div class="vslt">
                        <select name="school" id="areaslt-school" data-type="school" onchange="showBuildings()">
                            <{if !empty($school_list)}>
                            <{foreach $school_list as $v}>
                            <option value="<{$v['id']}>"
                            <{if $v['id'] == $consignee['school']}>selected<{/if}> ><{$v['name']}></option>
                            <{/foreach}>
                            <{/if}>
                        </select>
                        <span><i class="iconfont">&#xe615;</i></span>
                    </div>
                </dd>
            </dl>
            <dl>
                <dt>楼号</dt>
                <dd>
                    <div class="vslt">
                        <select name="building">
                        </select>
                        <span><i class="iconfont">&#xe615;</i></span>
                    </div>
                </dd>
            </dl>
            <dl>
                <dt>房间号</dt>
                <dd><input name="room" class="vinput" placeholder="如123" value="<{$consignee['room']}>"></input></dd>
            </dl>
            <dl>
                <dt>收件人</dt>
                <dd><input name="receiver" type="text" class="vinput" value="<{$consignee['receiver']}>"></dd>
            </dl>
            <dl>
                <dt>手机号码</dt>
                <dd><input name="mobile" type="number" pattern="[0-9]*" class="vinput" placeholder="请填写常用手机号"
                           value="<{$consignee['mobile']}>"></dd>
            </dl>
            <dl style="display: none">
                <dt>选择省份</dt>
                <dd>
                    <div class="vslt">
                        <select name="province" id="areaslt-province" data-type="province">
                            <option value="11" selected>浙江省</option>
                        </select>
                        <span><i class="iconfont">&#xe615;</i></span>
                    </div>
                </dd>
            </dl>
            <dl style="display: none">
                <dt>选择城市</dt>
                <dd>
                    <div class="vslt">
                        <select name="city" id="areaslt-city">
                            <option value="1" selected>杭州市</option>
                        </select>
                        <span><i class="iconfont">&#xe615;</i></span>
                    </div>
                </dd>
            </dl>
            <dl style="display: none">
                <dt>选择区/县</dt>
                <dd>
                    <div class="vslt">
                        <select name="borough" id="areaslt-borough">
                            <option value="3" selected>江干区</option>
                        </select>
                        <span><i class="iconfont">&#xe615;</i></span>
                    </div>
                </dd>
            </dl>

            <dl style="display:none">
                <dt>邮编</dt>
                <dd><input name="zip" type="number" pattern="[0-9]*" class="vinput" value="310018"></dd>
            </dl>
        </form>
        <a class="submit xauto mt15 f14 center" onclick="saveConsignee()">保 存</a>
    </div>
    <{else}>
    <div class="header">
        <div class="op lt"><a href="javascript:history.back(-1)"><i class="f20 iconfont">&#xe602;</i></a></div>
        <h2>新建收件地址</h2>
    </div>
    <div class="address uform module">
        <form id="consignee-form">
            <input type="hidden" name="id" value="0"/>
            <dl>
                <dt>选择学校</dt>
                <dd>
                    <div class="vslt">
                        <select name="school" id="areaslt-school" data-type="school" onchange="showBuildings()">
                            <{if !empty($school_list)}>
                            <{foreach $school_list as $v}>
                            <option value="<{$v['id']}>"><{$v['name']}></option>
                            <{/foreach}>
                            <{/if}>
                        </select>
                        <span><i class="iconfont">&#xe615;</i></span>
                    </div>
                </dd>
            </dl>
            <dl>
                <dt>楼号</dt>
                <dd>
                    <div class="vslt">
                        <select name="building">
                        </select>
                        <span><i class="iconfont">&#xe615;</i></span>
                    </div>
                </dd>
            </dl>
            <dl>
                <dt>房间号</dt>
                <dd><input name="room" class="vinput" placeholder="如123"></input></dd>
            </dl>
            <dl>
                <dt>收件人</dt>
                <dd><input name="receiver" type="text" class="vinput"></dd>
            </dl>
            <dl>
                <dt>手机号码</dt>
                <dd><input name="mobile" type="number" pattern="[0-9]*" class="vinput" placeholder="请填写常用手机号"></dd>
            </dl>
            <dl style="display: none">
                <dt>选择省份</dt>
                <dd>
                    <div class="vslt">
                        <select name="province" id="areaslt-province" data-type="province">
                            <option value="11" selected>浙江省</option>
                        </select>
                        <span><i class="iconfont">&#xe615;</i></span>
                    </div>
                </dd>
            </dl>
            <dl style="display: none">
                <dt>选择城市</dt>
                <dd>
                    <div class="vslt">
                        <select name="city" id="areaslt-city">
                            <option value="1" selected>杭州市</option>
                        </select>
                        <span><i class="iconfont">&#xe615;</i></span>
                    </div>
                </dd>
            </dl>
            <dl style="display: none">
                <dt>选择区/县</dt>
                <dd>
                    <div class="vslt">
                        <select name="borough" id="areaslt-borough">
                            <option value="3" selected>江干区</option>
                        </select>
                        <span><i class="iconfont">&#xe615;</i></span>
                    </div>
                </dd>
            </dl>
            <dl style="display:none">
                <dt>邮编</dt>
                <dd><input name="zip" type="number" pattern="[0-9]*" class="vinput" value="310018"></dd>
            </dl>
        </form>
        <a class="submit xauto mt15 f14 center" href="javascript:void(0)" onClick="saveConsignee()">保 存</a>
    </div>
    <{/if}>
</div>
<{include file='mobile/default/lib/footer.html'}>
</body>
</html>